function getQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(t);return null!=r?unescape(r[2]):null}function dateFormatYMDHM(e){try{var t=new Date(parseInt(e.replace("/Date(","").replace(")/",""),10)),r=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate(),a=t.getHours();a<10&&(a="0"+a);var i=t.getMinutes();return i<10&&(i="0"+i),t.getFullYear()+"-"+r+"-"+n+" "+a+":"+i}catch(s){return""}}function dateFormatYMD(e){try{var t=new Date(parseInt(e.replace("/Date(","").replace(")/",""),10)),r=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate();return t.getFullYear()+"-"+r+"-"+n}catch(a){return""}}function formatDate(e){var t=new Date;t.setTime(e);var r=new Date,n=r.getTime()-t.getTime();if(n<=6e5)return n<=6e4?Math.ceil(n/1e3)+"秒前":Math.ceil(n/6e4)+"分钟前";var a=t.getMinutes();if(a<10&&(a="0"+a),r.getYear()==t.getYear()){if(r.getMonth()==t.getMonth()){if(t.getDate()==r.getDate())return"今天 "+t.getHours()+":"+a;if(t.getDate()==r.getDate()-1)return"昨天 "+t.getHours()+":"+a;if(t.getDate()==r.getDate()-2)return"前天 "+t.getHours()+":"+a}return t.getMonth()+1+"月"+t.getDate()+"日 "+t.getHours()+":"+a}return t.getYear()+1900+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.getHours()+":"+a}var loginOrRegister=function(){function e(){return $("#validateform").validate({errorPlacement:function(e,t){e.insertAfter(t)},rules:{userName:{required:!0,maxlength:8},mobilePhone:{required:!0,minlength:11,isMobile:!0},password:{required:!0,isPassword:!0,minlength:6,maxlength:12}},messages:{userName:{required:"必须填写姓名",maxlength:"姓名最大长度不能超过50个字符"},mobilePhone:{required:"必须填写手机号码",minlength:"手机号码长度不能小于11位",isMobile:"手机格式不正确"},password:{required:"必须填写密码",isPassword:"密码为6-12个数字字母组合",minlength:"密码长度不能少于6位",maxlength:"密码长度不能超于12位"}}})}function t(){0==s?(11==$("#mobile").val().length&&$("#sendCode").attr("disabled",!1),$("#sendCode").text("获取验证码"),s=i,window.clearInterval(a)):($("#sendCode").attr("disabled",!0),$("#sendCode").text("重新发送("+s+")"),s--)}var r=function(){$("#signup").show(),$(".modal-backdrop").show(),$(".js-registerWrap").hide(),$(".js-loginWrap").show(),$("#signin_span").addClass("active-title"),$("#register_span").removeClass("active-title")},n=function(){$("#signup").show(),$(".modal-backdrop").show(),$(".js-loginWrap").hide(),$(".js-registerWrap").show(),$("#signin_span").removeClass("active-title"),$("#register_span").addClass("active-title")};$("#js-signin-btn").click(function(){r()}),$("#signin_span").click(function(){r()}),$("#js-signup-btn").click(function(){n()}),$("#register_span").click(function(){n()}),$(".modal-backdrop").click(function(){$(".modal-backdrop").hide(),$("#signup").hide()}),jQuery.validator.addMethod("isMobile",function(e,t){var r=e.length,n=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(t)||11==r&&n.test(e)},"请正确填写您的手机号码"),jQuery.validator.addMethod("isPassword",function(e,t){var r=/^[_0-9a-z]{6,16}$/i;return this.optional(t)||r.test(e)},"密码格式不正确");var a,i=60,s=i,o=[];$("#sendCode").click(function(){if(o=[],!(s<60)){$("input").removeClass("change");var e=$("#mobile").val();return 11!=e.length?void o.push({message:"手机号码格式不正确"}):void $.post("/system/user/find.api",{mobile:e},function(r){var n=jQuery.parseJSON(r);return 0!=n.errors.length?void(o=n.errors):($("#sendCode").attr("disabled","true").css("color","#868383"),void $.post("/system/verification.api",{mobile:e},function(e){var r=jQuery.parseJSON(e);0!=r.errors.length?o=r.errors:($("#sendCode").css("color","#333"),t(),a=setInterval(t,1e3))}))})}}),$("#signup-btn").click(function(){if(e().form()){var t={name:$("#name").val(),mobile:$("#mobile").val(),password:hex_md5($("#password").val())};$.post("/system/register.api",t,function(e){jQuery.parseJSON(e);if(0!=result.errors.length)o=result.errors,$("#doJoin").attr("disabled",!1);else{store.set("user",result.user),store.set("passport",result.passport);var t=getQueryString("redirectUrl");setTimeout(function(){t?window.location=t:window.location="index.html"},3e3)}})}})};